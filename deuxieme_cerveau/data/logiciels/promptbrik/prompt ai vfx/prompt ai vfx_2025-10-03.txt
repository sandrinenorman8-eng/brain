03:19:35: # =============================================
# üî• NETTOYAGE TOTAL DE VISUAL STUDIO CODE
# Supprime TOUT : extensions, config, cache, install, t√¢ches, etc.
# =============================================

Write-Host "üõë Fermeture forc√©e de tous les processus VS Code..." -ForegroundColor Red
Stop-Process -Name "Code", "Code Helper", "Code - Insiders" -Force -ErrorAction SilentlyContinue

Start-Sleep -Seconds 2

# === 1. Supprimer les dossiers principaux ===
$DossiersASupprimer = @(
    "$env:USERPROFILE\.vscode",                     # Extensions classiques
    "$env:USERPROFILE\.vscode-insiders",            # Version Insiders
    "$env:APPDATA\Code",                            # Config utilisateur
    "$env:APPDATA\Code - Insiders",
    "$env:LOCALAPPDATA\Programs\Microsoft VS Code", # Installation classique
    "$env:LOCALAPPDATA\Programs\Microsoft VS Code Insiders",
    "$env:LOCALAPPDATA\Code",                       # Cache & donn√©es locales
    "$env:LOCALAPPDATA\Code - Insiders"
)

foreach ($Dossier in $DossiersASupprimer) {
    if (Test-Path $Dossier) {
        Write-Host "üóëÔ∏è  Suppression : $Dossier" -ForegroundColor Yellow
        Remove-Item -Recurse -Force $Dossier
    }
}

# === 2. Supprimer les entr√©es du registre (si install√© via .exe) ===
$RegKeys = @(
    "HKCU:\Software\Microsoft\Windows\CurrentVersion\Uninstall\{EA457B21-F73E-494C-ACAB-524FDE069978}_is1", # VS Code
    "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{EA457B21-F73E-494C-ACAB-524FDE069978}_is1"
)

foreach ($Key in $RegKeys) {
    if (Test-Path $Key) {
        Write-Host "üóëÔ∏è  Suppression cl√© registre : $Key" -ForegroundColor Magenta
        Remove-Item -Path $Key -Recurse -Force
    }
}

# === 3. Supprimer les t√¢ches planifi√©es li√©es √† VS Code ===
$TachesVSCode = Get-ScheduledTask | Where-Object {
    $_.TaskName -like "*Code*" -or
    $_.TaskName -like "*VSCode*" -or
    $_.TaskPath -like "*Code*"
}

if ($TachesVSCode) {
    foreach ($Tache in $TachesVSCode) {
        Write-Host "‚è∞ Suppression t√¢che planifi√©e : $($Tache.TaskName)" -ForegroundColor Cyan
        Unregister-ScheduledTask -TaskName $Tache.TaskName -TaskPath $Tache.TaskPath -Confirm:$false
    }
} else {
    Write-Host "‚ÑπÔ∏è  Aucune t√¢che planifi√©e li√©e √† VS Code trouv√©e." -ForegroundColor Gray
}

# === 4. Nettoyer les variables d'environnement (si ajout√© au PATH) ===
$Path = [System.Environment]::GetEnvironmentVariable("Path", "User")
if ($Path -match "Microsoft VS Code") {
    $NouveauPath = ($Path.Split(';') | Where-Object { $_ -notlike "*Microsoft VS Code*" }) -join ';'
    [System.Environment]::SetEnvironmentVariable("Path", $NouveauPath, "User")
    Write-Host "üßπ Variable PATH utilisateur nettoy√©e." -ForegroundColor Green
}

# === 5. Supprimer les raccourcis ===
$Raccourcis = @(
    "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Visual Studio Code",
    "$env:DESKTOP\Visual Studio Code.lnk"
)
foreach ($Racc in $Raccourcis) {
    if (Test-Path $Racc) {
        Remove-Item $Racc -Force
        Write-Host "üóëÔ∏è  Raccourci supprim√© : $Racc" -ForegroundColor Gray
    }
}

# === 6. (Optionnel) Supprimer les dossiers `.vscode` dans vos projets ===
# ‚ö†Ô∏è Cela effacera les r√©glages de projet (launch.json, tasks.json, etc.)
$Reponse = Read-Host "`n‚ö†Ô∏è  Voulez-vous aussi supprimer TOUS les dossiers `.vscode` dans vos documents ? (o/n)"
if ($Reponse -eq 'o' -or $Reponse -eq 'O') {
    $DossiersProjets = @(
        "$env:USERPROFILE\Documents",
        "$env:USERPROFILE\Desktop",
        "$env:USERPROFILE\Source",
        "$env:USERPROFILE\Projects"
    )
    foreach ($Dossier in $DossiersProjets) {
        if (Test-Path $Dossier) {
            $DossiersVSCodeProjets = Get-ChildItem -Path $Dossier -Recurse -Directory -Name ".vscode" -ErrorAction SilentlyContinue
            foreach ($D in $DossiersVSCodeProjets) {
                $CheminComplet = Join-Path $Dossier $D
                Write-Host "üóëÔ∏è  Suppression projet .vscode : $CheminComplet" -ForegroundColor Red
                Remove-Item -Recurse -Force (Split-Path $CheminComplet)
            }
        }
    }
}

Write-Host "`n‚úÖ NETTOYAGE TOTAL TERMIN√â." -ForegroundColor Green
Write-Host "‚û°Ô∏è  Red√©marrez votre ordinateur pour garantir l'effacement complet des processus r√©siduels." -ForegroundColor Yellow
Write-Host "üîí Ensuite, scannez avec Malwarebytes ou Windows Defender pour confirmer la propret√© du syst√®me." -ForegroundColor Cyan
05:00:15: Pour cr√©er une extension, toujours reprendre √† z√©ro.
